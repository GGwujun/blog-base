<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-base/umi.css" />
    <script>
      window.routerBase = "/blog-base";
    </script>
    <script>
      window.publicPath = window.resourceBaseUrl || "/blog-base/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>
      36丨数据库没有备份，没有使用Binlog的情况下，如何恢复数据？ - 大师兄
    </title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/sql必知必会/03.第二章sql性能优化篇/17" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-base/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>计算机基础<ul><li><a href="/blog-base/编译原理之美">编译原理之美</a></li><li><a href="/blog-base/编译原理实战">编译原理实战</a></li><li><a href="/blog-base/深入浅出计算机组成原理">深入浅出计算机组成原理</a></li><li><a href="/blog-base/详解http">详解http</a></li><li><a href="/blog-base/计算机网络通关29讲">计算机网络通关29讲</a></li><li><a href="/blog-base/网络排查案例课">网络排查案例课</a></li><li><a href="/blog-base/linux操作系统">linux操作系统</a></li><li><a href="/blog-base/linux内核技术实战课">linux内核技术实战课</a></li><li><a href="/blog-base/linux性能优化实战">linux性能优化实战</a></li><li><a href="/blog-base/程序员数学基础">程序员数学基础</a></li><li><a href="/blog-base/趣谈网络协议">趣谈网络协议</a></li><li><a href="/blog-base/操作系统实战">操作系统实战</a></li><li><a href="/blog-base/软件工程之美">软件工程之美</a></li><li><a aria-current="page" class="active" href="/blog-base/sql必知必会">sql必知必会</a></li><li><a href="/blog-base/操作系统实战45讲">操作系统实战45讲</a></li><li><a href="/blog-base/网络编程实战">网络编程实战</a></li><li><a href="/blog-base/趣谈linux操作系统">趣谈linux操作系统</a></li></ul></span><span>算法<ul><li><a href="/blog-base/常用算法25讲">常用算法25讲</a></li><li><a href="/blog-base/数据结构与算法之美">数据结构与算法之美</a></li><li><a href="/blog-base/业务开发算法50讲">业务开发算法50讲</a></li><li><a href="/blog-base/动态规划面试宝典">动态规划面试宝典</a></li></ul></span><span>前端开发<ul><li><a href="/blog-base/正则表达式入门">正则表达式入门</a></li></ul></span><span>前端工程化</span><span>前端性能优化</span><span>移动端开发</span><span>软件测试</span><span>产品与用户体验</span><span>面试</span><span>杂谈<ul><li><a href="/blog-base/代码之丑">代码之丑</a></li><li><a href="/blog-base/代码精进之路">代码精进之路</a></li><li><a href="/blog-base/数据分析思维课">数据分析思维课</a></li><li><a href="/blog-base/朱涛kotlin编程第一课">朱涛kotlin编程第一课</a></li><li><a href="/blog-base/重学线性代数">重学线性代数</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-base/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>计算机基础<ul><li><a href="/blog-base/编译原理之美">编译原理之美</a></li><li><a href="/blog-base/编译原理实战">编译原理实战</a></li><li><a href="/blog-base/深入浅出计算机组成原理">深入浅出计算机组成原理</a></li><li><a href="/blog-base/详解http">详解http</a></li><li><a href="/blog-base/计算机网络通关29讲">计算机网络通关29讲</a></li><li><a href="/blog-base/网络排查案例课">网络排查案例课</a></li><li><a href="/blog-base/linux操作系统">linux操作系统</a></li><li><a href="/blog-base/linux内核技术实战课">linux内核技术实战课</a></li><li><a href="/blog-base/linux性能优化实战">linux性能优化实战</a></li><li><a href="/blog-base/程序员数学基础">程序员数学基础</a></li><li><a href="/blog-base/趣谈网络协议">趣谈网络协议</a></li><li><a href="/blog-base/操作系统实战">操作系统实战</a></li><li><a href="/blog-base/软件工程之美">软件工程之美</a></li><li><a aria-current="page" class="active" href="/blog-base/sql必知必会">sql必知必会</a></li><li><a href="/blog-base/操作系统实战45讲">操作系统实战45讲</a></li><li><a href="/blog-base/网络编程实战">网络编程实战</a></li><li><a href="/blog-base/趣谈linux操作系统">趣谈linux操作系统</a></li></ul></li><li>算法<ul><li><a href="/blog-base/常用算法25讲">常用算法25讲</a></li><li><a href="/blog-base/数据结构与算法之美">数据结构与算法之美</a></li><li><a href="/blog-base/业务开发算法50讲">业务开发算法50讲</a></li><li><a href="/blog-base/动态规划面试宝典">动态规划面试宝典</a></li></ul></li><li>前端开发<ul><li><a href="/blog-base/正则表达式入门">正则表达式入门</a></li></ul></li><li>前端工程化</li><li>前端性能优化</li><li>移动端开发</li><li>软件测试</li><li>产品与用户体验</li><li>面试</li><li>杂谈<ul><li><a href="/blog-base/代码之丑">代码之丑</a></li><li><a href="/blog-base/代码精进之路">代码精进之路</a></li><li><a href="/blog-base/数据分析思维课">数据分析思维课</a></li><li><a href="/blog-base/朱涛kotlin编程第一课">朱涛kotlin编程第一课</a></li><li><a href="/blog-base/重学线性代数">重学线性代数</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-base/sql必知必会">sql必知必会</a></li><li><a href="/blog-base/sql必知必会/01.开篇词">01.开篇词</a><ul><li><a href="/blog-base/sql必知必会/01.开篇词/01"><span>开篇词丨SQL可能是你掌握的最有用的技能</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇">02.第一章SQL语法基础篇</a><ul><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/01"><span>01丨了解SQL：一门半衰期很长的语言</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/02"><span>02丨DBMS的前世今生</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/03"><span>03丨学会用数据库的方式思考SQL是如何执行的</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/04"><span>04丨使用DDL创建数据库&amp;数据表时需要注意什么？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/05"><span>05丨检索数据：你还在SELECT * 么？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/06"><span>06丨数据过滤：SQL数据过滤都有哪些方法？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/07"><span>07丨什么是SQL函数？为什么使用SQL函数可能会带来问题？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/08"><span>08丨什么是SQL的聚集函数，如何利用它们汇总表的数据？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/09"><span>09丨子查询：子查询的种类都有哪些，如何提高子查询的性能？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/10"><span>10丨常用的SQL标准有哪些，在SQL92中是如何使用连接的？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/11"><span>11丨SQL99是如何使用连接的，与SQL92的区别是什么？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/12"><span>12丨视图在SQL中的作用是什么，它是怎样工作的？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/13"><span>13丨什么是存储过程，在实际项目中用得多么？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/14"><span>14丨什么是事务处理，如何使用COMMIT和ROLLBACK进行操作？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/15"><span>15丨初识事务隔离：隔离的级别有哪些，它们都解决了哪些异常问题？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/16"><span>16丨游标：当我们需要逐条处理数据时，该怎么做？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/17"><span>17丨如何使用Python操作MySQL？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/18"><span>18丨SQLAlchemy：如何使用Python ORM框架来操作MySQL？</span></a></li><li><a href="/blog-base/sql必知必会/02.第一章sql语法基础篇/19"><span>19丨基础篇总结：如何理解查询优化、通配符以及存储过程？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-base/sql必知必会/03.第二章sql性能优化篇">03.第二章SQL性能优化篇</a><ul><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/01"><span>20丨当我们思考数据库调优的时候，都有哪些维度可以选择？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/02"><span>21丨范式设计：数据表的范式有哪些，3NF指的是什么？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/03"><span>22丨反范式设计：3NF有什么不足，为什么有时候需要反范式设计？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/04"><span>23丨索引的概览：用还是不用索引，这是一个问题</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/05"><span>24丨索引的原理：我们为什么用B+树来做索引？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/06"><span>25丨Hash索引的底层原理是什么？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/07"><span>26丨索引的使用原则：如何通过索引让SQL查询效率最大化？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/08"><span>27丨从数据页的角度理解B+树查询</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/09"><span>28丨从磁盘I/O的角度理解SQL查询的成本</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/10"><span>29丨为什么没有理想的索引？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/11"><span>30丨锁：悲观锁和乐观锁是什么？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/12"><span>31丨为什么大部分RDBMS都会支持MVCC？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/13"><span>32丨查询优化器是如何工作的？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/14"><span>33丨如何使用性能分析工具定位SQL执行慢的原因？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/15"><span>34丨答疑篇：关于索引以及缓冲池的一些解惑</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/16"><span>35丨数据库主从同步的作用是什么，如何解决数据不一致问题？</span></a></li><li><a aria-current="page" class="active" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17"><span>36丨数据库没有备份，没有使用Binlog的情况下，如何恢复数据？</span></a></li><li><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/18"><span>37丨SQL注入：你的SQL是如何被注入的？</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms">04.第三章认识DBMS</a><ul><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/01"><span>38丨如何在Excel中使用SQL语言？</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/02"><span>39丨WebSQL：如何在H5中存储一个本地数据库？</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/03"><span>40丨SQLite：为什么微信用SQLite存储聊天记录？</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/04"><span>41丨初识Redis：Redis为什么会这么快？</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/05"><span>42丨如何使用Redis来实现多用户抢票问题</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/06"><span>43丨如何使用Redis搭建玩家排行榜？</span></a></li><li><a href="/blog-base/sql必知必会/04.第三章认识dbms/07"><span>44丨DBMS篇总结和答疑：用SQLite做词云</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/05.第四章sql项目实战">05.第四章SQL项目实战</a><ul><li><a href="/blog-base/sql必知必会/05.第四章sql项目实战/01"><span>45丨数据清洗：如何使用SQL对数据进行清洗？</span></a></li><li><a href="/blog-base/sql必知必会/05.第四章sql项目实战/02"><span>46丨数据集成：如何对各种数据库进行集成和转换？</span></a></li><li><a href="/blog-base/sql必知必会/05.第四章sql项目实战/03"><span>47丨如何利用SQL对零售数据进行分析？</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/06.结束语">06.结束语</a><ul><li><a href="/blog-base/sql必知必会/06.结束语/01"><span>结束语 | 互联网的下半场是数据驱动的时代</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/07.期末考试">07.期末考试</a><ul><li><a href="/blog-base/sql必知必会/07.期末考试/01"><span>期末测试丨对于SQL的有关内容，你掌握了多少呢？</span></a></li></ul></li><li><a href="/blog-base/sql必知必会/summary">sql必知必会</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="InnoDB存储引擎的表空间" data-depth="2"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#innodb存储引擎的表空间"><span>InnoDB存储引擎的表空间</span></a></li><li title="如果.ibd文件损坏了，数据如何找回" data-depth="2"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#如果ibd文件损坏了数据如何找回"><span>如果.ibd文件损坏了，数据如何找回</span></a></li><li title="InnoDB文件的损坏与恢复实例" data-depth="2"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#innodb文件的损坏与恢复实例"><span>InnoDB文件的损坏与恢复实例</span></a></li><li title="生成InnoDB数据表" data-depth="3"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#生成innodb数据表"><span>生成InnoDB数据表</span></a></li><li title="模拟损坏.ibd文件" data-depth="3"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#模拟损坏ibd文件"><span>模拟损坏.ibd文件</span></a></li><li title="备份数据表" data-depth="3"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#备份数据表"><span>备份数据表</span></a></li><li title="删除旧表，改名新表" data-depth="3"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#删除旧表改名新表"><span>删除旧表，改名新表</span></a></li><li title="关闭innodb_force_recovery，并重启数据库" data-depth="3"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#关闭innodb_force_recovery并重启数据库"><span>关闭innodb_force_recovery，并重启数据库</span></a></li><li title="总结" data-depth="2"><a href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#总结"><span>总结</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="36丨数据库没有备份没有使用binlog的情况下如何恢复数据"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#36丨数据库没有备份没有使用binlog的情况下如何恢复数据"><span class="icon icon-link"></span></a>36丨数据库没有备份，没有使用Binlog的情况下，如何恢复数据？</h1><p>我们上节课讲解了MySQL的复制技术，通过主从同步可以实现读写分离，热备份，让服务器更加高可用。MySQL的复制主要是通过Binlog来完成的，Binlog记录了数据库更新的事件，从库I/O线程会向主库发送Binlog更新的请求，同时主库二进制转储线程会发送Binlog给从库作为中继日志进行保存，然后从库会通过中继日志重放，完成数据库的同步更新。这种同步操作是近乎实时的同步，然而也有人为误操作情况的发生，比如DBA人员为了方便直接在生产环境中对数据进行操作，或者忘记了当前是在开发环境，还是在生产环境中，就直接对数据库进行操作，这样很有可能会造成数据的丢失，情况严重时，误操作还有可能同步给从库实时更新。不过我们依然有一些策略可以防止这种误操作，比如利用延迟备份的机制。延迟备份最大的作用就是避免这种“手抖”的情况，让我们在延迟从库进行误操作前停止下来，进行数据库的恢复。</p><p>当然如果我们对数据库做过时间点备份，也可以直接恢复到该时间点。不过我们今天要讨论的是一个特殊的情况，也就是在没做数据库备份，没有开启使用Binlog的情况下，尽可能地找回数据。</p><p>今天的内容主要包括以下几个部分：</p><ol><li>InnoDB存储引擎中的表空间是怎样的？两种表空间存储方式各有哪些优缺点？</li><li>如果.ibd文件损坏了，数据该如何找回？</li><li>如何模拟InnoDB文件的损坏与数据恢复？</li></ol><h2 id="innodb存储引擎的表空间"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#innodb存储引擎的表空间"><span class="icon icon-link"></span></a>InnoDB存储引擎的表空间</h2><p>InnoDB存储引擎的文件格式是.ibd文件，数据会按照表空间（tablespace）进行存储，分为共享表空间和独立表空间。如果想要查看表空间的存储方式，我们可以对<code>innodb_file_per_table</code>变量进行查询，使用<code>show variables like &#x27;innodb_file_per_table&#x27;;</code>。ON表示独立表空间，而OFF则表示共享表空间。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimage7d0d7dc5aae75a7d5d2c599c7cb8dd97440d.a8287b03.png" alt=""/><br/>如果采用共享表空间的模式，InnoDB存储的表数据都会放到共享表空间中，也就是多个数据表共用一个表空间，同时表空间也会自动分成多个文件存放到磁盘上。这样做的好处在于单个数据表的大小可以突破文件系统大小的限制，最大可以达到64TB，也就是InnoDB存储引擎表空间的上限。不足也很明显，多个数据表存放到一起，结构不清晰，不利于数据的找回，同时将所有数据和索引都存放到一个文件中，也会使得共享表空间的文件很大。</p><p>采用独立表空间的方式可以让每个数据表都有自己的物理文件，也就是table_name.ibd的文件，在这个文件中保存了数据表中的数据、索引、表的内部数据字典等信息。它的优势在于每张表都相互独立，不会影响到其他数据表，存储结构清晰，利于数据恢复，同时数据表还可以在不同的数据库之间进行迁移。</p><h2 id="如果ibd文件损坏了数据如何找回"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#如果ibd文件损坏了数据如何找回"><span class="icon icon-link"></span></a>如果.ibd文件损坏了，数据如何找回</h2><p>如果我们之前没有做过全量备份，也没有开启Binlog，那么我们还可以通过.ibd文件进行数据恢复，采用独立表空间的方式可以很方便地对数据库进行迁移和分析。如果我们误删除（DELETE）某个数据表或者某些数据行，也可以采用第三方工具回数据。</p><p>我们这里可以使用Percona Data Recovery Tool for InnoDB工具，能使用工具进行修复是因为我们在使用DELETE的时候是逻辑删除。我们之前学习过InnoDB的页结构，在保存数据行的时候还有个删除标记位，对应的是页结构中的delete_mask属性，该属性为1的时候标记了记录已经被逻辑删除，实际上并不是真的删除。不过当有新的记录插入的时候，被删除的行记录可能会被覆盖掉。所以当我们发生了DELETE误删除的时候，一定要第一时间停止对误删除的表进行更新和写入，及时将.ibd文件拷贝出来并进行修复。</p><p>如果已经开启了Binlog，就可以使用闪回工具，比如mysqlbinlog或者binlog2sql，从工具名称中也能看出来它们都是基于Binlog来做的闪回。原理就是因为Binlog文件本身保存了数据库更新的事件（Event），通过这些事件可以帮我们重现数据库的所有更新变化，也就是Binlog回滚。</p><p>下面我们就来看下没有做过备份，也没有开启Binlog的情况下，如果.ibd文件发生了损坏，如何通过数据库自身的机制来进行数据恢复。</p><p>实际上，InnoDB是有自动恢复机制的，如果发生了意外，InnoDB可以在读取数据表时自动修复错误。但有时候.ibd文件损坏了，会导致数据库无法正常读取数据表，这时我们就需要人工介入，调整一个参数，这个参数叫做<code>innodb_force_recovery</code>。</p><p>我们可以通过命令<code>show variables like &#x27;innodb_force_recovery&#x27;;</code>来查看当前参数的状态，你能看到默认为0，表示不进行强制恢复。如果遇到错误，比如ibd文件中的数据页发生损坏，则无法读取数据，会发生MySQL宕机的情况，此时会将错误日志记录下来。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimage6eba6edf81f6402311ca7f8ee8619b656fba.7c291717.png" alt=""/><br/><code>innodb_force_recovery</code>参数一共有7种状态，除了默认的0以外，还可以为1-6的取值，分别代表不同的强制恢复措施。</p><p>当我们需要强制恢复的时候，可以将<code>innodb_force_recovery</code>设置为1，表示即使发现了损坏页也可以继续让服务运行，这样我们就可以读取数据表，并且对当前损坏的数据表进行分析和备份。</p><p>通常<code>innodb_force_recovery</code>参数设置为1，只要能正常读取数据表即可。但如果参数设置为1之后还无法读取数据表，我们可以将参数逐一增加，比如2、3等。一般来说不需要将参数设置到4或以上，因为这有可能对数据文件造成永久破坏。另外当<code>innodb_force_recovery</code>设置为大于0时，相当于对InnoDB进行了写保护，只能进行SELECT读取操作，还是有限制的读取，对于WHERE条件以及ORDER BY都无法进行操作。</p><p>当我们开启了强制恢复之后，数据库的功能会受到很多限制，我们需要尽快把有问题的数据表备份出来，完成数据恢复操作。整体的恢复步骤可以按照下面的思路进行：</p><p>1.使用<code>innodb_force_recovery</code>启动服务器</p><p>将<code>innodb_force_recovery</code>参数设置为1，启动数据库。如果数据表不能正常读取，需要调大参数直到能读取数据为止。通常设置为1即可。</p><p>2.备份数据表</p><p>在备份数据之前，需要准备一个新的数据表，这里需要使用MyISAM存储引擎。原因很简单，InnoDB存储引擎已经写保护了，无法将数据备份出来。然后将损坏的InnoDB数据表备份到新的MyISAM数据表中。</p><p>3.删除旧表，改名新表</p><p>数据备份完成之后，我们可以删除掉原有损坏的InnoDB数据表，然后将新表进行改名。</p><p>4.关闭<code>innodb_force_recovery</code>，并重启数据库</p><p><code>innodb_force_recovery</code>大于1的时候会有很多限制，我们需要将该功能关闭，然后重启数据库，并且将数据表的MyISAM存储引擎更新为InnoDB存储引擎。</p><h2 id="innodb文件的损坏与恢复实例"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#innodb文件的损坏与恢复实例"><span class="icon icon-link"></span></a>InnoDB文件的损坏与恢复实例</h2><p>我们刚才说了InnoDB文件损坏时的人工操作过程，下面我们用一个例子来模拟下。</p><h3 id="生成innodb数据表"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#生成innodb数据表"><span class="icon icon-link"></span></a>生成InnoDB数据表</h3><p>为了简便，我们创建一个数据表t1，只有id一个字段，类型为int。使用命令<code>create table t1(id int);</code>即可。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimage0c340c2790f539d4f35aec6dd0703b059134.ca3c83fd.png" alt=""/><br/>然后创建一个存储过程帮我们生成一些数据：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">BEGIN</span></div><div class="token-line"><span class="token plain">    -- 当前数据行</span></div><div class="token-line"><span class="token plain">    DECLARE i INT DEFAULT 0;</span></div><div class="token-line"><span class="token plain">    -- 最大数据行数</span></div><div class="token-line"><span class="token plain">    DECLARE max_num INT DEFAULT 100;</span></div><div class="token-line"><span class="token plain">    -- 关闭自动提交</span></div><div class="token-line"><span class="token plain">    SET autocommit=0;</span></div><div class="token-line"><span class="token plain">    REPEAT</span></div><div class="token-line"><span class="token plain">    SET i=i+1;</span></div><div class="token-line"><span class="token plain">    -- 向t1表中插入数据</span></div><div class="token-line"><span class="token plain">    INSERT INTO t1(id) VALUES(i);</span></div><div class="token-line"><span class="token plain">    UNTIL i = max_num</span></div><div class="token-line"><span class="token plain">    END REPEAT;</span></div><div class="token-line"><span class="token plain">    -- 提交事务</span></div><div class="token-line"><span class="token plain">    COMMIT;</span></div><div class="token-line"><span class="token plain">    END</span></div></pre></div><p>然后我们运行<code>call insert_t1()</code>，这个存储过程帮我们插入了100条数据，这样我们就有了t1.ibd这个文件。</p><h3 id="模拟损坏ibd文件"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#模拟损坏ibd文件"><span class="icon icon-link"></span></a>模拟损坏.ibd文件</h3><p>实际工作中我们可能会遇到各种各样的情况，比如.ibd文件损坏等，如果遇到了数据文件的损坏，MySQL是无法正常读取的。在模拟损坏.ibd文件之前，我们需要先关闭掉MySQL服务，然后用编辑器打开t1.ibd，类似下图所示：</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimaged37cd34734f6dfbf0e01cf4a40bb549e147c.cf38668b.png" alt=""/><br/>文件是有二进制编码的，看不懂没有关系，我们只需要破坏其中的一些内容即可，比如我在t1.ibd文件中删除了2行内容（文件大部分内容为0，我们在文件中间部分找到一些非0的取值，然后删除其中的两行：4284行与4285行，原ibd文件和损坏后的ibd文件见<a target="_blank" rel="noopener noreferrer" href="https://github.com/cystanford/innodb_force_recovery">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a target="_blank" rel="noopener noreferrer" href="https://github.com/cystanford/innodb_force_recovery">地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。其中t1.ibd为创建的原始数据文件,t1-损坏.ibd为损坏后的数据文件，你需要自己创建t1数据表，然后将t1-损坏.ibd拷贝到本地，并改名为t1.ibd）。</p><p>然后我们保存文件，这时.ibd文件发生了损坏，如果我们没有打开<code>innodb_force_recovery</code>，那么数据文件无法正常读取。为了能读取到数据表中的数据，我们需要修改MySQL的配置文件，找到<code>[mysqld]</code>的位置，然后再下面增加一行<code>innodb_force_recovery=1</code>。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimagea394a3a226bbd1b435393039b75618be6e94.d770d965.png" alt=""/></p><h3 id="备份数据表"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#备份数据表"><span class="icon icon-link"></span></a>备份数据表</h3><p>当我们设置<code>innodb_force_recovery</code>参数为1的时候，可以读取到数据表t1中的数据，但是数据不全。我们使用<code>SELECT * FROM t1 LIMIT 10;</code>读取当前前10条数据。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimage760a761a5495f9769de35f60f112e4d94b0a.ff462714.png" alt=""/><br/>但是如果我们想要完整的数据，使用<code>SELECT * FROM t1 LIMIT 100;</code>就会发生如下错误。</p><p><img src="data:image/png;base64,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" alt=""/><br/>这是因为读取的部分包含了已损坏的数据页，我们可以采用二分查找判断数据页损坏的位置。这里我们通过实验，可以得出只有最后一个记录行收到了损坏，而前99条记录都可以正确读出（具体实验过程省略）。</p><p>这样我们就能判断出来有效的数据行的位置，从而将它们备份出来。首先我们创建一个相同的表结构t2，存储引擎设置为MyISAM。我刚才讲过这里使用MyISAM存储引擎是因为在<code>innodb_force_recovery=1</code>的情况下，无法对innodb数据表进行写数据。使用命令<code>CREATE TABLE t2(id int) ENGINE=MyISAM;</code>。</p><p>然后我们将数据表t1中的前99行数据复制给t2数据表，使用：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">INSERT INTO t2 SELECT * FROM t1 LIMIT 99;</span></div></pre></div><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimagea938a91d4a2d259bba1c2aeb9a5b95619238.d1216e03.png" alt=""/><br/>我们刚才讲过在分析t1数据表的时候无法使用WHERE以及ORDER BY等子句，这里我们可以实验一下，如果想要查询id&lt;10的数据行都有哪些，那么会发生如下错误。原因是损坏的数据页无法进行条件判断。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimagefc9dfc00a89e22a301826bbdd7b37d7b7c9d.5e949f77.png" alt=""/></p><h3 id="删除旧表改名新表"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#删除旧表改名新表"><span class="icon icon-link"></span></a>删除旧表，改名新表</h3><p>刚才我们已经恢复了大部分的数据。虽然还有一行记录没有恢复，但是能找到绝大部分的数据也是好的。然后我们就需要把之前旧的数据表删除掉，使用<code>DROP TABLE t1;</code>。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA50AAAB9CAMAAAAWXvdnAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAD5UExUReLu/NLe7H+Mml9reVNeahcaHgUGBwAAAAYGBhgYGC0tLTAwMCQkJAwMDAMDAyoqKhISEkhISIeHh5CQkGxsbAkJCX5+fmBgYLS0tMDAwKioqBUVFVRUVJ6enqqqqr29vb6+vrW1tRcXF6urq66urpaWlkJCQiMjI7q6ugEBATk5OXh4eLe3t5ycnJOTkwoKCmZmZqmpqb+/v7a2thYWFgsLC1paWlZhbSosMBwdHl9qdmBiZl9gYWl0gJ+hpa6vsGt2gqiqrrm6u4qKiiEhITY2Np+fnzw8PGhzf5aYnKOkpVlkcDs+QjIzNGVwfISGioyNjoSEhP///+VDJRkAAAABYktHRFINYC2QAAAAB3RJTUUH5wkXCAkxiURmBgAAAAFvck5UAc+id5oAABQfSURBVHja7Z1pQyO5EYYnp91m2lwGN8Yc5hgMDGDPALubZHeTzJU7mf//ZyK5hFqSVV1Su23ETj2fdtHoLL1QraP06tWrX/36N7/93e9bDMOkxStWJ8MkCquTYVKF1ckwqcLqZJhUYXUyTKqwOhkmVVidDJMqrE6GSRVWJ8OkCquTYVKF1ckwqcLqZJhUYXUyTKqwOhkmVVidDJMqrE6GSRVWJ8OkCquTYVKF1ckwqcLqZJhUYXUyTKqwOhkmVVidDJMqK1VnO+usaV633YRO1g4s57VRjlmUmyDT8jJfV9cfmiOgcm8dHat3WA4zgcohWK9uGEE3W7fqYNJnperc2Nza1vQ23IStzY3AcnpGOWZRboJMe13m29H1h+YIqNxbx5bVOyyHmUDlEOxWN4xgZ3PXqoNJn5WqM+sXe5rtzE0o+llgOdtGOWZRboJMWyvz5br+0BwBlXvrKKzeYTnMBCqHYFDdMIK8P7DqYNJnpercHx4MBoPD4shVp0g4LI5Hvc7JRjeknN2D0+JYlHFcnB6eHe2dd7KNtpsgahrItDfZ/iytm59c9EYxOfwI5RwVh4eQaXwqc2h1Qh0iYSQr6Hqaa9VhJhzs7vs7OADOxgHqvMxPTvKuP+Gid8rqfGE8w3fn1fWZq06RcHX99mhwHuZ7ic+yN9dvRRlvr99cDc/2inPlKpoJ8ktNpt0oj1B4z7eDo5gcfoQ6z66vriDTzRuZQ6sT6hAJR7KCDU9zrTrMBPe708ohM90EqFO41f7Pgx3ZsDGr84XxDGu2wsVy1dnyeoRVaF84XxtYzqXlJEMazOr4HEjN28Wgn5fNFTmcoijX3dsqtIPq/9e2A9QpWuX/PIgcXSYNklHnnXRujyyPsAo9ee/Wby131K+D7sZJR7q1hwfD/bAcKMLrvB3eldNdlLa7LhN0HdJ7N73nVhPqXN8d3K5XDgm41W5RolVZloG/7VGncHkzIGjYmZWSjDq70rk9szzCKvTk7ebrljvq18FGb+tcurVXnawdlgNFeJ3rolatTlEa7I/oOqT3bnrPrSbUmb+mdlTArXaLguVf8Lc96vQsYzPJkIw6W+08m0zfHb0vtu4DCiknb/chv5ruHb0tDjp2QsvQwf3W9P34XTHJ8vZlWA6Uy538oW24iqK0ndmfnbKOPM9kBaIrnbnmtmqqsyuqrf7rdv84HYn6naJEq4qiEAl+dT48ymRJ0LAzKwXU+d33P2QO2inrznwftRTY3pdpehHU+OfGzNEJcgXWzAEg6pTO7a3rEaKETXedAFsURf/prw+dgwDdOIE64r+GKzsoBpEYEnCr5Wpxr2NZUDjis3XyY786PZtMTDKAOv/wxz/1HTa1S7X2KP73cW02sbOhTBtmZcLTPze8Lp3wKH5q5lDJmDrba8PJdbE36JWVo3xb6hSDSAxJvvnY2x6LHOPtnmVBkSD+ezJLY3W+MECdP/70c+GgnbL7me8zfZw5Pp0DmQYe4b12ihy/SCdMxU/NHACqzlb7wfUIUb4tdYpBJIYE3GqR4934vWVB4YhLT3tSsDpfHqDOP//lrzPDjkbjY/np9/Z47/ZKfef4J5Yw+sWkEDnkR4385xfq68tMmH74aH3hAbg6xWeQmIdm5SjUdJ9cyEmpKw9Qp5ODoJ465+ug1KlzECeYUHWizVUDzt+dCWOqc7w9mWwXY+FZSv/yWrmjfh2AJyVySLfJdEfNBIlZFFClzrbw4eZzeCDUqfw7XRStTjcHQS11euog1FnmINSJerZoc9WA68+TzYXO2DPLwFRnMcmyybQQfwZjFkGdBUoz4eTTZ89fwip1uuupKIQ61V8QXTmtTjcHQS11euog1FnmINQJLkv511awY405dhqhnT/988tmZxazOJY65RGYgTr/QnyWmVsUD/BtCeqsmqPAitQp/e09+7x5gDodjxAFV6f+hVVLnXrjJFKdrQqht/is0Aulrjq1A/u4lrdhXRY8qcXU2aBnK/3tCHX6PUIUVJ2ls1/Ls802rYRgz7bF6vwFUled5tG4S9jThP21xdTpnrJDIdQ56nUu3pzGqNPdJyRA1Vme5JtXp6pDNGx8ps7loQf23Byszm+Quups6a2W/kfrq2URdTa6o2It/wbvqISCqrNcxo7fUZFu/a0vgd5RadVVJ393JswC6oSABh/6X6xQIAuos5utu+dTUejpvvN6d/tmvHczlOdTV6fOo8GtPNd6M66hTnkA+MaXILoSOSR0c5/GfC6YC5MMC6gTDux97J/Ly8H67vAC6mz2JJ/0t7UPuTp1jnoX8k6I6VYHNVf+j3Trx74E+iRfq6Y672YX4i0LMsmwgDoBV2sLqLNyMddhWWeFQlnKWaHFWlVLnXxWKGVodeqYAu61/lkUve7O5q50427eqHtUddWZyA2yUFauTvoGmTUkTqRAVueLhFanjsfjhsQR/3swvLvM96UbNz5Vd5DrqjOR29ehrFyd9O1ra0ikq7pe2VwzgdWZJrQ6W6YJvVsU1lSsq85EIpeEsnJ10pFL0A62WJ0vFEedKuipo064QG+tQ6KBANwEc5pYUb9u3pQRlBuP+uVfYiaifgUHY4bm7kHUL3q1Oijql0qA5taK+oV2cDbmT811XF4IB8bqTBNHnSpguKNOWHa3tAbzp9w+0N+dboKpTtiDUbNBzB8dQVlPrDCBwG+A2fbFuVW5TvCoU/8G8OcI/tXQwkLvoeo065B91vs8ngTzM7lMkGkFpU60gzpyyRGMubk5A5/7rM40cdSpfuq95ej31jx+kZWA5gBqLVDS0ab9S8xEtOlIt9pfFOrse4YEDSpdN9p0rXDaMUvlzEoBdf7t7/+ANR71U1hWMFch3MWf1lPsaM9umU5wz7NZOQCoAxIOhoFbbrAk5alcJ6iinH54NvfMog5Ct/z8PdcLZS04kagXZtzmViVAc9EEAqKDVuVPdpVhqGXUbN7vTA9Q5z//9W/YH1E/hSX5dev7xN44aZFvFqHfnZ6Xexp/5UgV5fSDeOUo5rsTrRwG0drUCHrlyBqSuq8cxT/jBN+d1vczkwyhMflquT/+NVsmIfh4fMoQ6oRYxbNwxbHuj/KFBfSNE+a5AF842KdnVgqhTv1UXbz7o3xh+Zv5ZsHH7Zil4XlulEkGQp0Qq3gWrvhYhjSJuGb08Hig7lEFhdFinoc2Xx9LF0KdtZY0gbvhbcxyI8MwDoQ6IVZxGTs6gvbasAxGTQe5YxjGgVAnxCqud3u+/VBmpYPcMQzj8AyvHDEMEwSrk2FShdXJMKnC6mSYVGF1MkyqsDoZJlVYnQyTKqxOhkkVVifDpAqrk2FShdXJMKnC6mSYVGF1MkyqmOpM87W4qkhW/uBekbixyF7XLCcBUAs+t2m72Xr86LrvwcQbCs2BRqxbBeEx7kx1Qsj3WTziwLDLq8DTKh1PZWtz9qPXu2Xg6ng2dAWqmpcbZQW14HObdmdzN350d8CuOke8odAcVsKqhwQqV3O3ElOdab6pURVBGX23MAY0OPbLA7Xgc5tWhXSMG93K8OZBRYXFPV/1kITHVtfq1E+NBT9wuwr8rdrfPTgtjhtRp36cTIVYMR8ne2GgFmzWtJf5yUkee5lePZwcoU43vHm8odAcZsJzzPZ9+dze8ajXOaGe29Pq9L+R89wQTxMtrk7zUSbrBaKXB2rBZk0rnOQQp8xGfHe6ocfJanY9D97EGArNgb7QtSLC3/TS6qx6X+75iH8IMLaCikexXxj0WDViWuEkR76mqPLFVV71prqENhSag37EcukEBvkGdX73/Q/o47PPR9CTuJft/Ux6QGf14v6ZllJFvXh1uq/rVj27Gwk4yUtXp+d1l3hDoTkSUGfgW9Kgzv/893/ow+3PR9Bz8nJhTz+5F49pKVXUi1enuxNR9WR9JOAkL12dntdd4g2F5khAnfAwo/XApA9Q548//fx+/K6YZHn7stV9yK+mKYSIvt+aoq3SM+6hc1C8Pd67vaoX98+0lCrqxatTjpUModilEuK5f5yOhEmWrc4HWY0d3jzeUGiOBNTZaufZZPru6H2xdV/xr4j3O+EdlZNcjpH0DgTmUmCm0X+g9csrJ3nXn0Ot+EFalfdc9anR1LeUrqN89oUwOt1B/5DAILo99+eoAs2BLtSjCWhRaD/El4YoatTrPKW1g4tSo0sbSi8xW+HN4w2F5oCEUe9CWDB4+kSOFW1atYxduWBMqBOiTT+uyfztbBY+evPJyPlaGYm6ryNR6/jUj2u5P4dImA3ekApDvVJ1tteGk+siwOh0B/1DAoPo9tyfowo0R7w60aLQfvS2pXs43u49pWXBRanRpQ0lcky2x6IOK7x5vKHQHJAw3p4ICwZPn8ixok2rWjXolYM4B6FOeEdl+vjQAu9AsPXk7wovp9DoP9D65ZXp470/h0iQ/wNpVd7zStVZPvtCGJ3uoH9IYBDdnvtzVIHmiFcnWhTaD/GlIYp6N37/lNYJLkqNLm0o5T1P7Fd74g2F5oCEd+ORsGDw9IkcqwDTth8y+a32vhzEOQh1oi765U5+MSlED9W4y0+ErmXCUjn6mzByGyRAnZMLsofV6Dry/kB+BtCfM2gH0SFB+4HmCJomVg4oCobEittPJHgqp03rqjO4qIgDPu4vk3hDoTlKC4ZOn/ixCjIt+auhrjrByxHegfJZ9B9o7f6Uk3dwrdy4xtUp3B/SOyCmgmHCsSgHPCDCs/V3EB0StB9ojiosV3F+2JXXibqjTgJqwSrTup5tcFENqTPMUGgOsx9hw153rAjTLk2d5Xpqnlu/f8rf1Xryzi+0WnXQw+u2ShclfokH/82hTSjXCEVXiFahHUSHBO0HmqOKy7Z6m8bK4f5dQ91RJ8FTeYBp4c+wXv4NLqohdYYZCs2h+xE8feLHKsi0ddQJexeEOlWCd9y113ny6bPlgaSrzkmWTaby6EbQWSF/B6mxEgntB+lZetTZvnQ/YVEsdTq/LWPUiVrQ3YkwW1WpnOqigr/wiDqCDYXm0F7naDyzXYw6HUPVGkRNDXXKdUjtBBAzzu+zaK9T+j6mB5KsZyv6MdkuItXpdpBWZ3ttKNch5z1bz/Ivin8RNN6zRS1o9sNtVZVyiKIaUWeModAcetgncNcpwrN1DVVrEA1TRqtTnZkLmnHlOf95dR4Xp5+/rlsnrhpX56jXsS4yxKP7cVgcRarT7SCtzrvhrdzDM3eT9VFFd+sUZX+oHjy2ht3di0Q3KXUCakH3BJzZqirlEEU1os4YQ6E54IrTqHdx0ZvZjp4+qKFqDaImWp2wzAvQMw7WpNzVde11ToUbZW4fNL9m29COStncCHW6HaTVKT+AnImlNpn6H8MeSK1aBI3cUUEt6A57Q0XF7F2gOyoxhkJzeLZaQndUXEPVGkRF/I5KedMnSJ1Hg1vPxXMwobohY8YtSFmdqrkR6nQ7WEudcE/+Q/9LWAgNuDsHw34LB0cXU6fHgnXVSRQVbCh94a1jjke8odAculXqllpoqzyGqjWIgJJa5fU1R53lLdkgdQrvwDisZLs/6napeWwtZXWq5kao0+1gLXXCca+P/fPZ5ZF9qrnaKfMcjaulTo8F66qTKCrmzBx6ki/GUGgOzxG/0JN8rqFqDSJQ4yRfGWEi9Fsq2ISttNUZc1WUWPNvRagTcC8zBg1J5ZXXuOaGJSxWVIyhPNcf4w2F5ljgFDx16zRoEP1F+XBukF1dP7m1cFcrSJ3ojSW3Mu2zRF5uj7xBFhOATrsm6r7/MtSp+/Gp//XD9ZeyHxBbsJN13UAARHMbV6dlwSDThuWoqwP0BhlqKI/N0RzxrUINVWsQW5E3yPTt68Piya2Fe85B6kRv+7qVaZ8lMjBM5O3ru6dVzQBX0byv4DE6kilOnbofn/vrH7+cl/0Qfqpo5MHwzg2iQzS3cXVaFgwybViOuupEb1+jhvLYHM0R3yrUULUGsRV5+1pHLikhlsRrTZOWGRwuyFK1IpfEBKCrFbkkUp1oP+KnyZLUGW/asBxL9CFpmzcYuSS+g0QdUZFLIOoXrDlZq1hmgKRPm19LHxKNnKQjcrmLbgAEVo1ZKYuP+hWjzvhgUmgHq4JJ+Wd1fPgp1B5oq+KbW9Uqvz2CirKaSxMZ9ctj8wajfsWPVVUdNaJ+6ejYVuw0cwXf/WSylvadUdzT69gO8H0QHJ9Nd8Rfx+LqNPshoecP2kF0SFqYOqty0M217IG2Kr65Va3y2yOoKKu5NO6GA2Eoj83RHIsNe3zP3Tr8W0Y+5t9RQWP8usuN/oi9eqWs6i93/Pqdv47F1en2I9TL8XcQDWJMeOi1mmvZA23VAs31t8o/unRRwSex0FlSZaiAVjU07PE9RycDWamjznIHSK+/6JNjcvsJvm9h/UUnWN/i8AFd5pgneAkE8Hzv6zoOhrMfma2yVp7oVSG3H3TIuqoO+odEJ6jVLbMONAfdXMseaKsWaK6/Vf41N7ood/oEWL5qrOaXWahWNTTs8T1HJwNZqaPO8vSE9kC0yyv/DpvvCflfitEvEKkc8wRvHwCRrxxZuzZB79dEPp5T1UH08Rz9sE3lyz1xzbXsgbZqgebGPJhEF+VOnwDLR7xyFNCqhoY9vufoZCArddTpnkZYBsFb77UIdxsYJnEcdd4Nb8u/xrXCN6PoWHbuTlazhLsNDJM4jjrLdxYjPJAw9LN+7imQZgl3Gxgmcdw12/ZDrqkVvhlFx7Jz4wg3iwod0F5O6QyzQlb3Mj29mMswjMnq1KmjNMvIy0FxlRnm22Z16rzcKX3mZbm1DPNLYnXqZBgmDlYnw6QKq5NhUoXVyTCpwupkmFRhdTJMqrA6GSZVWJ0MkyqsToZJFVYnw6QKq5NhUoXVyTCpwupkmFRhdTJMqvwfznllMFlObT0AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMjNUMDg6MDk6NDkrMDA6MDChl8HUAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTIzVDA4OjA5OjQ5KzAwOjAw0Mp5aAAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wOS0yM1QwODowOTo0OSswMDowMIffWLcAAAAASUVORK5CYII=" alt=""/><br/>更新表名，将数据表名称由t2改成t1，使用<code>RENAME TABLE t2 to t1;</code>。</p><p><img src="data:image/png;base64,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" alt=""/><br/>将新的数据表t1存储引擎改成InnoDB，不过直接修改的话，会报如下错误：</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimaged1a6d102e7ec02a228529b26bd070601b9a6.83967ed7.png" alt=""/></p><h3 id="关闭innodb_force_recovery并重启数据库"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#关闭innodb_force_recovery并重启数据库"><span class="icon icon-link"></span></a>关闭<code>innodb_force_recovery</code>，并重启数据库</h3><p>因为上面报错，所以我们需要将MySQL配置文件中的<code>innodb_force_recovery=1</code>删除掉，然后重启数据库。最后将t1的存储引擎改成InnoDB即可，使用<code>ALTER TABLE t1 engine = InnoDB;</code>。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimageab1babc06822471b4eb4036de1504840df1b.52dcf532.png" alt=""/></p><h2 id="总结"><a aria-hidden="true" tabindex="-1" href="/blog-base/sql必知必会/03.第二章sql性能优化篇/17#总结"><span class="icon icon-link"></span></a>总结</h2><p>我们刚才人工恢复了损坏的ibd文件中的数据，虽然没有100%找回，但是相比于束手无措来说，已经是不幸中的万幸，至少我们还可以把正确的数据页中的记录成功备份出来，尽可能恢复原有的数据表。在这个过程中相信你应该对ibd文件，以及InnoDB自身的强制恢复（Force Recovery）机制有更深的了解。</p><p>数据表损坏，以及人为的误删除都不是我们想要看到的情况，但是我们不能指望运气，或者说我们不能祈祷这些事情不会发生。在遇到这些情况的时候，应该通过机制尽量保证数据库的安全稳定运行。这个过程最主要的就是应该及时备份，并且开启二进制日志，这样当有误操作的时候就可以通过数据库备份以及Binlog日志来完成数据恢复。同时采用延迟备份的策略也可以尽量抵御误操作。总之，及时备份是非常有必要的措施，同时我们还需要定时验证备份文件的有效性，保证备份文件可以正常使用。</p><p>如果你遇到了数据库ibd文件损坏的情况，并且没有采用任何的备份策略，可以尝试使用InnoDB的强制恢复机制，启动MySQL并且将损坏的数据表转储到MyISAM数据表中，尽可能恢复已有的数据。总之机制比人为更靠谱，我们要为长期的运营做好充足的准备。一旦发生了误操作这种紧急情况，不要慌张，及时采取对应的措施才是最重要的。</p><p><img src="/blog-base/static/httpsstatic001geekbangorgresourceimage693369a3e8644e041b0b216cc6f7d882f133.8cea63e6.png" alt=""/></p><p>今天的内容到这里就结束了，我想问问，在日常工作中，你是否遇到过误操作的情况呢？你又是如何解决的？除了我上面介绍的机制外，还有哪些备份的机制可以增强数据的安全性？</p><p>欢迎你在评论区写下你的思考，也欢迎把这篇文章分享给你的朋友或者同事，一起交流一下。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/sql必知必会/03.第二章SQL性能优化篇/17.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/23 19:22:26</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-base/umi.js"></script>
  </body>
</html>
